"use strict";var _createClass=function(){function a(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,i,e){return i&&a(t.prototype,i),e&&a(t,e),t}}();function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var Gauge=function(){function t(){_classCallCheck(this,t),this.setDefaults()}return _createClass(t,[{key:"update",value:function(t){if(void 0!==t&&(this.data=t),void 0===this.debug||(this.toString(),!this.varsHasErrors())){var i=this.prepareVars();if(void 0!==this.tickModulus&&(this.drawTicks(i),this.drawTickBackground()),void 0!==this.background&&this.drawBackground(i),void 0===this.dataFillType){var e=i.data;void 0!==this.allowOverflow&&this.allowOverflow||e>this.maxValue&&(e=this.maxValue),void 0!==this.allowUnderflow&&this.allowUnderflow||e<this.minValue&&(e=this.minValue);for(var a=0;a<=Math.abs(e/this.tickSize);a++){var s=void 0,o=void 0;0<i.data?(s=(i.orientation-this.tickOffset+i.tick*a)*Math.PI/180,o=(i.orientation-this.tickOffset+1+i.tick*a)*Math.PI/180):(s=(i.orientation-this.tickOffset+i.tick*a*-1)*Math.PI/180,o=(i.orientation-this.tickOffset+1+i.tick*a*-1)*Math.PI/180),this.appendArc(s,o,i,a)}}else{if("needle"===this.dataFillType){var h=i.data;void 0!==this.allowOverflow&&this.allowOverflow||h>this.maxValue&&(h=this.maxValue),void 0!==this.allowUnderflow&&this.allowUnderflow||h<this.minValue&&(h=this.minValue);var l=Math.abs(h/this.tickSize),r=void 0,n=void 0;r=0<i.data?(i.orientation-this.tickOffset+i.tick*l)*Math.PI/180:(i.orientation-this.tickOffset+i.tick*l*-1)*Math.PI/180,n=(i.orientation+i.tick*l)*Math.PI/180,this.appendArc(r,n,i,l)}else if("full"===this.dataFillType){var d=i.data;void 0!==this.allowOverflow&&this.allowOverflow||d>this.maxValue&&(d=this.maxValue),void 0!==this.allowUnderflow&&this.allowUnderflow||d<this.minValue&&(d=this.minValue);var c=void 0,u=void 0;0<i.data?(c=i.orientation*Math.PI/180,u=(i.orientation+i.tick*Math.abs(d/this.tickSize))*Math.PI/180):(c=i.orientation*Math.PI/180,u=(i.orientation+i.tick*Math.abs(d/this.tickSize)*-1)*Math.PI/180),this.appendArc(c,u,i,Math.abs(d/this.tickSize))}this.populateLabels()}}}},{key:"appendArc",value:function(t,i,e,a,s){var o=d3.arc().innerRadius(e.thicknessBase-this.offset-e.thicknessBase*this.thickness/10).outerRadius(e.thicknessBase-this.offset).startAngle(t).endAngle(i);this.svg.append("path").attr("id","arc-"+s).attr("d",o).attr("transform","translate("+this.width/2+","+this.height/2+")").attr("fill",e.color)}},{key:"prepareVars",value:function(){var t=this.createRootElements(),i=.3*Math.min(this.width,this.height),e=this.maxDegrees/(this.maxValue/this.tickSize),a=this.data;this.data>this.maxValue?this.maxValue:this.data,a=this.data<this.minValue?this.minValue:this.data;var s=this.color;return this.data>this.maxValue?s=this.overflowColor:this.data<this.minValue&&(s=this.underflowColor),{element:t,thicknessBase:i,tick:e,data:a,color:s,orientation:this.orientation}}},{key:"createRootElements",value:function(){var t=d3.select("#"+this.rootElement);return t.node().innerHTML="",t.node().style.width=this.width+"px",t.node().style.height=this.height+"px",this.svg=t.append("svg").attr("id",this.rootElement+"-svg").attr("width",this.width).attr("height",this.height),t}},{key:"drawBackground",value:function(t){var i=t.orientation*Math.PI/180,e=void 0,a="full"===this.backgroundFill?360:this.maxDegrees;e=0<=this.data?(t.orientation+a)*Math.PI/180:(t.orientation-a)*Math.PI/180;var s=d3.arc().innerRadius(t.thicknessBase-this.offset-t.thicknessBase*this.thickness/10).outerRadius(t.thicknessBase-this.offset).startAngle(i).endAngle(e);this.svg.append("path").attr("d",s).attr("transform","translate("+this.width/2+","+this.height/2+")").attr("fill",this.background)}},{key:"drawTicks",value:function(t){Math.abs(this.maxDegrees),this.maxValue;for(var i=0;i<=this.maxValue;i++)if(i%this.tickModulus==0){var e=this.maxDegrees/this.maxValue*i;this.drawLine(e,1,0)}for(var a=0;a<=this.maxValue;a++)if(a%this.bigTickModulus==0){var s=this.maxDegrees/this.maxValue*a;this.drawLine(s,3,1),this.drawTickLabels(s,a+this.unit)}if(this.minValue<0){for(var o=this.minValue;o<=0;o++)if(o%this.tickModulus==0){var h=this.maxDegrees/this.maxValue*o;this.drawLine(h,1,0)}for(var l=this.minValue;l<=0;l++)if(l%this.bigTickModulus==0){var r=this.maxDegrees/this.maxValue*l;this.drawLine(r,3,1),this.drawTickLabels(r,l+this.unit)}}}},{key:"drawTickBackground",value:function(){var t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",0),t.setAttribute("cy",0),t.setAttribute("r",this.width/this.tickCoverRadius),t.setAttribute("fill",this.tickCoverColor),t.setAttribute("transform","translate("+this.width/2+","+this.height/2+")"),d3.select("#"+this.rootElement+"-svg").node().appendChild(t)}},{key:"drawLine",value:function(t,i,e){t*=-1;var a=this.width/(3-e/10),s=Math.cos((90-this.orientation+t)*Math.PI/180)*a,o=-1*Math.sin((90-this.orientation+t)*Math.PI/180)*a,h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d","M0,0L"+s+","+o),h.setAttribute("stroke",this.tickColor),h.setAttribute("transform","translate("+this.width/2+","+this.height/2+")"),h.setAttribute("stroke-width",i),d3.select("#"+this.rootElement+"-svg").node().appendChild(h)}},{key:"drawTickLabels",value:function(t,i){t*=-1;var e=void 0,a=void 0,s=void 0;e=this.width/2.5+10,a=Math.cos((90-this.orientation+t)*Math.PI/180)*e,s=-1*Math.sin((90-this.orientation+t)*Math.PI/180)*e;var o=(this.width+this.width/100*-3)/2,h=(this.height+this.height/100*2)/2,l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",a),l.setAttribute("y",s),l.style.fontSize=this.tickLabelSize,l.setAttribute("transform","translate("+o+","+h+")"),l.style.fill=this.tickLabelColor,l.style.fontFamily=this.tickLabelFontFamily,l.textContent=i,Math.ceil(Math.abs(t))===this.maxDegrees&&(0<t?l.setAttribute("y",+l.getAttribute("y")+this.tickLabelSize/4*3):l.setAttribute("y",+l.getAttribute("y")+this.tickLabelSize/4*4*-1),this.tickLabelHideLast&&(l.style.display="none")),d3.select("#"+this.rootElement+"-svg").node().appendChild(l)}},{key:"populateLabels",value:function(){d3.select("#"+this.labelElement).text(this.data+this.unit)}},{key:"orientationVar",value:function(){return{NORTH:0,SOUTH:180,EAST:90,WEST:270}}},{key:"setDefaults",value:function(){this.width=400,this.height=400,this.thickness=3,this.tickSize=1,this.offset=0,this.orientation=this.orientationVar().NORTH,this.unit="",this.minValue=-50,this.maxValue=50,this.allowOverflow=!1,this.allowUnderflow=!0,this.maxDegrees=360,this.color="#aaa",this.overflowColor="#aaa",this.underflowColor="#aaa",this.showTickLabels=!1,this.background="rgba(0,0,0,0)",this.backgroundFill="maxDegrees",this.marginOffset=50,this.tickColor="#000",this.tickCoverColor="#fff",this.tickLabelSize="11px",this.tickLabelColor="#000",this.tickLabelFontFamily="monospace",this.tickOffset=1,this.tickCoverRadius=3.2,this.tickLabelHideLast=!1}},{key:"setConfig",value:function(t){this.rootElement=void 0===t.rootElement?this.rootElement:t.rootElement,this.labelElement=void 0===t.labelElement?this.labelElement:t.labelElement,this.width=void 0===t.width?this.width:t.width,this.height=void 0===t.height?this.height:t.height,this.thickness=void 0===t.thickness?this.thickness:t.thickness,this.tickSize=void 0===t.tickSize?this.tickSize:t.tickSize,this.offset=void 0===t.offset?this.offset:t.offset,this.orientation=void 0===t.orientation?this.orientation:t.orientation,this.unit=void 0===t.unit?this.unit:t.unit,this.minValue=void 0===t.minValue?this.minValue:t.minValue,this.maxValue=void 0===t.maxValue?this.maxValue:t.maxValue,this.allowOverflow=void 0===t.allowOverflow?this.allowOverflow:t.allowOverflow,this.allowUnderflow=void 0===t.allowUnderflow?this.allowUnderflow:t.allowUnderflow,this.maxDegrees=void 0===t.maxDegrees?this.maxDegrees:t.maxDegrees,this.data=void 0===t.data?this.data:t.data,this.color=void 0===t.color?this.color:t.color,this.overflowColor=void 0===t.overflowColor?this.color:t.overflowColor,this.underflowColor=void 0===t.underflowColor?this.color:t.underflowColor,this.showTickLabels=void 0===t.showTickLabels?this.showTickLabels:t.showTickLabels,this.tickModulus=void 0===t.tickModulus?this.tickModulus:t.tickModulus,this.bigTickModulus=void 0===t.bigTickModulus?this.bigTickModulus:t.bigTickModulus,this.background=void 0===t.background?this.background:t.background,this.backgroundFill=void 0===t.backgroundFill?this.backgroundFill:t.backgroundFill,this.tickColor=void 0===t.tickColor?this.tickColor:t.tickColor,this.tickCoverColor=void 0===t.tickCoverColor?this.tickCoverColor:t.tickCoverColor,this.tickLabelColor=void 0===t.tickLabelColor?this.tickLabelColor:t.tickLabelColor,this.tickLabelSize=void 0===t.tickLabelSize?this.tickLabelSize:t.tickLabelSize,this.tickLabelFontFamily=void 0===t.tickLabelFontFamily?this.tickLabelFontFamily:t.tickLabelFontFamily,this.tickOffset=void 0===t.tickOffset?this.tickOffset:t.tickOffset,this.tickCoverRadius=void 0===t.tickCoverRadius?this.tickCoverRadius:t.tickCoverRadius,this.dataFillType=void 0===t.dataFillType?this.dataFillType:t.dataFillType,this.tickLabelHideLast=void 0===t.tickLabelHideLast?this.tickLabelHideLast:t.tickLabelHideLast}}]),t}();